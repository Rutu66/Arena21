{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Responsive UI</title>
    <link rel="stylesheet" href="{% static 'css/style.css' %}">


</head>


<body>
    <div class="container">
        <!-- Header Section -->
        <header class="header"> 
            <div class="profile">
                <img src="https://via.placeholder.com/50" alt="User Profile">
                <div class="greeting">
                    <h1>Welcome Back! {{ request.user }}</h1>
                    <p>Here are the latest Events...</p>
                </div>
            </div>
            <div class="menu-button" onclick="toggleMenu()">☰</div>

        </header>

        <!-- Balance Card Section -->
        <div class="balance-card">
            <h2>Total Balance</h2>
            <div class="balance-amount">&#8377; {{ profile.balance }}</div>
            <div class="balance-actions">
                <a href="{% url 'dashboard' %}" class="my-account-link">
                    <button class="my-account">My Account</button>
                </a>
            </div>
            
            
        </div>

        <!-- Categories Section -->
        <section class="categories">
            <h2>Categories</h2>
            <div class="category-list">
                {% for category in categories %}
                <div class="category-item">
                    <img src="{{ category.icon.url }}" alt="Category">
                    <p>{{ category.name }}</p>
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Trending Section -->
        <section class="trending">
            <h2>Trading Now</h2>
            <div class="trending-section">
                {% for iteam in subcategories %}
                <div class="trending-item">
                    <img src="{{ iteam.icon.url }}" alt="{{ iteam.name }}">
                    <span>{{ iteam.name }}</span>
                    {% if iteam.is_live %}
                    <div class="live">LIVE</div>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Events Section -->
        {% comment %} <section class="events">
            {% for event in events %}
            <div class="question-card">
                <div class="logo">
                    <img src="{{ event.icon.url }}" alt="{{ event.name }}">
                </div>
                <div class="content">
                    <h3>{{ event.title }}</h3>
                    <h4>{{ event.description }}</h4>
                    <div class="actions">
                        <button class="yes" onclick="openForm('{{ event.id }}', 'yes', '{{ event.title }}')">Yes ₹8</button>
                        <button class="no" onclick="openForm('{{ event.id }}', 'no', '{{ event.title }}')">No ₹2</button>
                    </div>
                </div>
            </div>
            {% endfor %}
        </section> {% endcomment %}
        <section class="events">
    {% for event in events %}
    <div class="question-card">
        <div class="logo">
            <img src="{{ event.icon.url }}" alt="{{ event.name }}">
        </div>
        <div class="content">
            <h3>{{ event.title }}</h3>
            <h4>{{ event.description }}</h4>
            <div class="actions">
                {% with event_id=event.id %}
                <button class="yes" onclick="openForm('{{ event_id }}', 'yes', '{{ event.title }}')">
                    Yes 
                    {% for id, price in max_price_per_quantity_yes.items %}
                        {% if id == event_id %}
                            ₹{{ price }}
                        {% endif %}
                    {% endfor %}
                </button>
                <button class="no" onclick="openForm('{{ event_id }}', 'no', '{{ event.title }}')">
                    No 
                    {% for id, price in max_price_per_quantity_no.items %}
                        {% if id == event_id %}
                            ₹{{ price }}
                        {% endif %}
                    {% endfor %}
                </button>
                {% endwith %}
            </div>
        </div>
    </div>
    {% endfor %}
</section>


        
    </div>

<div id="menu" class="menu">
    <div class="menu-header">
        <div class="user-details">
            <img src="profile-pic-url" alt="Profile Picture" class="profile-pic">
            <div class="user-info">
                <span class="username">John Doe</span>
                <p class="user-handle">@johndoe</p>
            </div>
        </div>
        <span class="close-button" onclick="toggleMenu()">✖</span>
    </div>
    <ul class="menu-items">
        <li><a href="#"><i class="icon-profile"></i>Profile</a></li>
        <li><a href="#"><i class="icon-dashboard"></i>Dashboard</a></li>
        <li><a href="#"><i class="icon-portfolio"></i>Portfolio</a></li>
        <li class="logout"><a href="#"><i class="icon-logout"></i>Logout</a></li>
    </ul>
</div>


    

    <div id="betForm" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeForm()">&times;</span>
            <h2 id="questionTitle">Question goes here</h2>
    
            <!-- Existing betting form elements -->
            <div class="response-buttons">
                <button type="button" class="response-button" id="yesButton" onclick="setResponse('yes')">Yes ₹<span id="yesPrice">8</span></button>
                <button type="button" class="response-button" id="noButton" onclick="setResponse('no')">No ₹<span id="noPrice">2</span></button>
            </div>
            <form id="orderForm" method="post" action="{% url 'place_order' %}">
                {% csrf_token %}
                <input type="hidden" id="event_id" name="event" value="">
                <input type="hidden" id="response" name="response" value="">
                
                <div class="price-quantity">
                    <div class="price-slider slider-container">
                        <label for="price">Price</label>
                        <div class="range-labels">
                            <span>1</span>
                            <span>10</span>
                        </div>
                        <input type="range" id="price" name="price_per_quantity" min="1" max="10" value="5" step="1">
                        <input type="number" id="priceValue" name="price_per_quantity" min="1" max="10" value="5" step="1">
                    </div>
                    <div class="quantity-slider slider-container">
                        <label for="quantity">Quantity</label>
                        <div class="range-labels">
                            <span>1</span>
                            <span>1000</span>
                        </div>
                        <input type="range" id="quantity" name="quantity" min="1" max="1000" value="500" step="1">
                        <input type="number" id="quantityValue" name="quantity" min="1" max="1000" value="500" step="1">
                    </div>
                </div>
                
                <div class="bet-summary">
                    <div class="column">
                        <p class="label">You put</p>
                        <p class="amount">₹<span id="putAmount">2500.0</span></p>
                    </div>
                    <div class="column">
                        <p class="label">You get</p>
                        <p class="amount">₹<span id="getAmount">5000.0</span></p>
                    </div>
                </div>
            
                <!-- Static Order Book -->
                <div class="order-book">
                    <ul class="nav">
                        <!-- Navigation elements if needed -->
                    </ul>
                    <div class="order-book-table">
                        <table id="orderTable">
                            <thead>
                                <tr>
                                    <th>Price</th>
                                    <th>Quantity</th>
                                </tr>
                            </thead>
                            <tbody id="orderTableBody">
                                <!-- Rows will be added dynamically here -->
                            </tbody>
                        </table>
                    </div>
                </div>
                
                <div class="swipe-container">
                    <div class="swipe-wrapper" id="swipeWrapper">
                        <div class="swipe-button" id="swipeButton">
                            <span class="swipe-text" id="swipeText">Slide to Place Order</span>
                            <div class="swipe-handle" id="swipeHandle">
                                <i class="fa fa-chevron-right"></i>
                            </div>
                        </div>
                    </div>
                </div>
            
                <p class="balance-amount-model">Your Balance: &#8377; {{ profile.balance }}</p>
            </form>
            
            <div id="message"></div> <!-- Display success or error messages here -->
            
        </div>
    </div>

    <script>
        let isSwiping = false;
        let startX;
        let currentX;
        const minSwipeDistance = 100;
        const swipeHandle = document.getElementById('swipeHandle');
        const swipeWrapper = document.getElementById('swipeWrapper');
        const swipeText = document.getElementById('swipeText');
    
        function startSwipe(event) {
            isSwiping = true;
            startX = event.clientX || event.touches[0].clientX; // Support for both mouse and touch
            swipeWrapper.classList.add('swiping');
            document.addEventListener('mousemove', swipeMove);
            document.addEventListener('mouseup', endSwipe);
            document.addEventListener('touchmove', swipeMove, { passive: false });  // Updated touch support
            document.addEventListener('touchend', endSwipe);    // Touch support
        }
    
        function swipeMove(event) {
            if (!isSwiping) return;
            currentX = event.clientX || event.touches[0].clientX; // Support for both mouse and touch
            let diffX = currentX - startX;
    
            if (diffX > 0 && diffX <= swipeWrapper.offsetWidth - swipeHandle.offsetWidth) {
                swipeHandle.style.left = `${diffX}px`;
                swipeText.style.opacity = 1 - (diffX / swipeWrapper.offsetWidth);
                event.preventDefault(); // Prevent default touch behavior like scrolling
            }
        }
    
        function endSwipe(event) {
            if (!isSwiping) return;
            isSwiping = false;
            let diffX = currentX - startX;
    
            if (diffX > swipeWrapper.offsetWidth / 2) {
                // Complete the swipe and submit the form
                swipeHandle.style.left = `${swipeWrapper.offsetWidth - swipeHandle.offsetWidth}px`;
                document.getElementById('orderForm').submit();
                setTimeout(resetSwipe, 1000); // Delay for reset after submission
            } else {
                // Revert the swipe
                resetSwipe();
            }
    
            swipeWrapper.classList.remove('swiping');
            document.removeEventListener('mousemove', swipeMove);
            document.removeEventListener('mouseup', endSwipe);
            document.removeEventListener('touchmove', swipeMove);  // Updated touch support
            document.removeEventListener('touchend', endSwipe);    // Touch support
        }
        
        
    
        function resetSwipe() {
            swipeHandle.style.left = '12px'; // Reset to initial position
            swipeText.style.opacity = 1;
        }
    
        // Attach event listeners
        swipeHandle.addEventListener('mousedown', startSwipe);
        swipeHandle.addEventListener('touchstart', startSwipe, { passive: true }); // Updated touch support
    
        function openForm(eventId, responseType, title) {
            currentEventId = eventId; // Store the event ID
            document.getElementById('betForm').style.display = 'block';
            document.getElementById('questionTitle').innerText = title; // Set the title
            document.getElementById('event_id').value = eventId;
            setResponse(responseType);
        }
        
    
        function closeForm() {
            document.getElementById('betForm').style.display = 'none';
        }
    
        function setResponse(responseType) {
            document.getElementById('response').value = responseType;
            if (responseType === 'yes') {
                document.getElementById('yesButton').classList.add('active');
                document.getElementById('noButton').classList.remove('active');
                swipeWrapper.classList.add('active');
                swipeWrapper.classList.remove('no-active');
            } else {
                document.getElementById('noButton').classList.add('active');
                document.getElementById('yesButton').classList.remove('active');
                swipeWrapper.classList.add('no-active');
                swipeWrapper.classList.remove('active');
            }
            calculateAmounts();
            fetchData(responseType);
        }
    
        function calculateAmounts() {
            var price = document.getElementById('price').value;
            var quantity = document.getElementById('quantity').value;
            document.getElementById('putAmount').innerText = (price * quantity).toFixed(2);
            document.getElementById('getAmount').innerText = (10 * quantity).toFixed(2);
        }
    
        document.getElementById('price').addEventListener('input', function() {
            document.getElementById('priceValue').value = this.value;
            calculateAmounts();
        });
    
        document.getElementById('quantity').addEventListener('input', function() {
            document.getElementById('quantityValue').value = this.value;
            calculateAmounts();
        });
    
        document.getElementById('priceValue').addEventListener('input', function() {
            document.getElementById('price').value = this.value;
            calculateAmounts();
        });
    
        document.getElementById('quantityValue').addEventListener('input', function() {
            document.getElementById('quantity').value = this.value;
            calculateAmounts();
        });
    
        function fetchData(responseType) {
            const orderTableBody = document.getElementById('orderTableBody');
            orderTableBody.innerHTML = ''; // Clear existing rows
        
            fetch(`/fetch-order-data/?response_type=${responseType}&event_id=${currentEventId}`)
                .then(response => response.json())
                .then(data => {
                    data.forEach(order => {
                        let row = `<tr><td>${order.price_per_quantity}</td><td>${order.quantity}</td></tr>`;
                        orderTableBody.innerHTML += row;
                    });
                })
                .catch(error => console.error('Error fetching data:', error));
        }
    </script>
    
    <script>
        function toggleMenu() {
            const menu = document.getElementById('menu');
            menu.classList.toggle('open');
        }
        
    </script>

    
    

</body>


</html>
